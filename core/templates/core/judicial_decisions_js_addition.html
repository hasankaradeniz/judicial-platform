<script>
// Herhangi bir filtre var mı kontrol et
function hasAnyFilter() {
    const formData = new FormData(document.getElementById('advancedSearchForm'));
    const simpleQuery = document.getElementById('simpleSearchInput').value.trim();
    
    // Basit arama terimi var mı?
    if (simpleQuery) return true;
    
    // Gelişmiş form filtrelerini kontrol et
    for (let [key, value] of formData.entries()) {
        if (value && value.trim() && key \!== 'q') {
            return true;
        }
    }
    
    // Gelişmiş form arama terimi
    const advancedQuery = formData.get('q');
    if (advancedQuery && advancedQuery.trim()) return true;
    
    return false;
}

// Form submit işlemini güncelle
function handleFormSubmit(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    let query = '';
    
    if (currentSearchMode === 'simple') {
        query = formData.get('q') || '';
        // Basit aramada sadece query kontrolü
        if (query.trim()) {
            performSearch(query.trim(), 1);
        }
    } else if (currentSearchMode === 'advanced') {
        // Gelişmiş aramada herhangi bir filtre yeterli
        if (hasAnyFilter()) {
            performAdvancedSearch(formData);
        } else {
            alert('Lütfen en az bir arama kriteri girin (arama terimi, karar numarası, tarih aralığı vb.)');
        }
    }
}

// Gelişmiş arama fonksiyonu
function performAdvancedSearch(formData) {
    if (isLoading) return;
    
    isLoading = true;
    updateUI('loading');
    
    const searchParams = new URLSearchParams();
    
    // Tüm form verilerini ekle
    for (let [key, value] of formData.entries()) {
        if (value && value.trim()) {
            searchParams.append(key, value.trim());
        }
    }
    
    // URL'i güncelle
    const newUrl = window.location.pathname + '?' + searchParams.toString();
    history.pushState({}, '', newUrl);
    
    // AJAX isteği gönder
    fetch(newUrl, {
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        displayResults(data);
        isLoading = false;
    })
    .catch(error => {
        console.error('Arama hatası:', error);
        updateUI('error');
        isLoading = false;
    });
}

// Hızlı filtre uygulama
function applyQuickFilter(courtType, dateRange) {
    const form = document.getElementById('advancedSearchForm');
    
    // Formu temizle
    form.reset();
    
    // Seçili filtreleri uygula
    if (courtType && courtType \!== 'all') {
        form.querySelector('[name=court_type]').value = courtType;
    }
    
    if (dateRange && dateRange \!== 'all') {
        const dateMapping = {
            'recent': 'last_year',
            'this_year': 'last_year',
            'landmark': 'last_5_years'
        };
        form.querySelector('[name=date_range]').value = dateMapping[dateRange] || dateRange;
    }
    
    // Gelişmiş moda geç
    switchSearchMode('advanced');
    
    // Arama yap
    const formData = new FormData(form);
    performAdvancedSearch(formData);
}

// Sayfa yüklendiğinde filtreleri kontrol et
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    
    // URL'de parametre varsa formu doldur
    if (urlParams.toString()) {
        const advancedForm = document.getElementById('advancedSearchForm');
        
        // Form alanlarını doldur
        for (let [key, value] of urlParams.entries()) {
            const field = advancedForm.querySelector();
            if (field) {
                field.value = value;
            }
        }
        
        // Gelişmiş moda geç
        switchSearchMode('advanced');
        
        // Otomatik arama yap
        const formData = new FormData(advancedForm);
        performAdvancedSearch(formData);
    }
});
</script>
