{% extends "core/base.html" %}
{% load static %}

{% block page_title %}Yargƒ± Kararlarƒ± Ara≈ütƒ±rma Platformu - Lexatech{% endblock %}

{% block extra_styles %}
<style>
  :root {
    --primary: #1a365d;
    --primary-light: #2c5aa0;
    --secondary: #d69e2e;
    --secondary-light: #fbd38d;
    --success: #047857;
    --danger: #c53030;
    --white: #ffffff;
    --light-gray: #f7fafc;
    --gray: #e2e8f0;
    --dark-gray: #4a5568;
    --text-primary: #2d3748;
    --text-secondary: #718096;
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.15);
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background-color: var(--light-gray);
    min-height: 100vh;
  }

  /* Hero Section */
  .hero-section {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    color: white;
    padding: 80px 0 60px;
    margin-bottom: 0;
    position: relative;
    overflow: hidden;
  }

  .hero-section::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%);
    animation: pulse 30s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }

  .hero-content {
    position: relative;
    z-index: 1;
  }

  .hero-title {
    font-size: 3.5rem;
    font-weight: 800;
    margin-bottom: 1.5rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }

  .hero-subtitle {
    font-size: 1.3rem;
    font-weight: 300;
    opacity: 0.9;
    margin-bottom: 2rem;
  }

  .stats-badge {
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 50px;
    padding: 12px 24px;
    font-size: 1rem;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 2rem;
  }

  /* Advanced Search Container */
  .search-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    box-shadow: var(--shadow-lg);
    padding: 50px;
    margin: -60px auto 60px;
    max-width: 900px;
    position: relative;
    z-index: 10;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .search-tabs {
    display: flex;
    background: var(--gray);
    border-radius: 12px;
    padding: 4px;
    margin-bottom: 30px;
  }

  .search-tab {
    flex: 1;
    padding: 12px 20px;
    text-align: center;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    background: transparent;
    border: none;
    color: var(--text-primary);
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .search-tab:hover {
    background: rgba(255, 255, 255, 0.8);
    color: var(--primary);
    transform: translateY(-1px);
  }

  .search-tab.active {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .search-form {
    display: none;
  }

  .search-form.active {
    display: block;
  }

  .smart-search-input {
    width: 100%;
    padding: 18px 25px 18px 50px;
    border: 2px solid var(--gray);
    border-radius: 12px;
    font-size: 17px;
    transition: all 0.3s ease;
    background: var(--white);
  }

  .smart-search-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(26, 54, 93, 0.1);
    transform: translateY(-1px);
  }

  .search-input-container {
    position: relative;
    margin-bottom: 20px;
  }

  .search-icon {
    position: absolute;
    left: 18px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    font-size: 1.2rem;
  }

  .advanced-filters {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .filter-group.full-width {
    grid-column: 1 / -1;
  }

  .filter-group.custom-date-range {
    grid-column: auto;
  }

  .filter-group {
    position: relative;
  }

  .filter-label {
    display: block;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .filter-label i {
    color: var(--secondary);
    font-size: 0.85rem;
  }

  .filter-select, .filter-input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--gray);
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: var(--white);
  }

  .filter-select:focus, .filter-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1);
    transform: translateY(-1px);
  }

  .search-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    align-items: center;
  }

  .btn-search {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    color: white;
    border: none;
    padding: 18px 40px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 17px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .btn-search:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .btn-clear {
    background: transparent;
    color: var(--text-secondary);
    border: 2px solid var(--gray);
    padding: 16px 32px;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-clear:hover {
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-1px);
  }

  /* Results Section */
  .results-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    box-shadow: var(--shadow-lg);
    margin-bottom: 40px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .results-header {
    background: linear-gradient(135deg, var(--light-gray) 0%, white 100%);
    padding: 25px 30px;
    border-bottom: 1px solid var(--gray);
    display: flex;
    justify-content: between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
  }

  .results-info {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .results-count {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
  }

  .search-time {
    background: var(--success);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .results-controls {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .sort-select {
    padding: 8px 12px;
    border: 1px solid var(--gray);
    border-radius: 8px;
    font-size: 0.9rem;
    background: var(--white);
  }

  .view-toggle {
    display: flex;
    background: var(--gray);
    border-radius: 8px;
    padding: 2px;
  }

  .view-btn {
    padding: 8px 12px;
    border: none;
    background: transparent;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .view-btn.active {
    background: var(--primary);
    color: white;
  }

  /* Decision Cards */
  .decisions-grid {
    padding: 30px;
  }

  .decision-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid var(--gray);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 20px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .decision-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
  }

  .decision-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
    border-color: var(--primary);
  }

  .decision-header {
    display: flex;
    justify-content: between;
    align-items: start;
    margin-bottom: 15px;
    flex-wrap: wrap;
    gap: 10px;
  }

  .court-info {
    flex: 1;
  }

  .court-name {
    font-weight: 700;
    color: var(--primary);
    font-size: 1.1rem;
    margin-bottom: 5px;
  }

  .case-number {
    color: var(--text-secondary);
    font-size: 0.9rem;
  }

  .decision-meta {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .relevance-score {
    background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .decision-date {
    background: var(--gray);
    color: var(--text-primary);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .decision-content {
    margin: 15px 0;
  }

  .decision-summary {
    color: var(--text-primary);
    line-height: 1.6;
    font-size: 0.95rem;
/* Pattern-based formatting for summary sections */  .decision-summary {    white-space: pre-line;  }
  }

  .keywords {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 15px 0;
  }

  .keyword-tag {
    background: rgba(26, 54, 93, 0.1);
    color: var(--primary);
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
  }

  .decision-actions {
    display: flex;
    gap: 10px;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid var(--gray);
  }

  .btn-detail {
    background: var(--primary);
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
  }

  .btn-detail:hover {
    background: var(--primary-light);
    transform: translateY(-1px);
    color: white;
    text-decoration: none;
  }

  .btn-bookmark, .btn-share {
    background: transparent;
    border: 1px solid var(--gray);
    color: var(--text-secondary);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-bookmark:hover, .btn-share:hover {
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-1px);
  }

  /* Loading States */
  .loading-container {
    text-align: center;
    padding: 60px 20px;
  }

  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid var(--gray);
    border-top: 4px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .loading-text {
    color: var(--text-secondary);
    font-size: 1.1rem;
    margin-bottom: 10px;
  }

  .loading-subtext {
    color: var(--text-secondary);
    font-size: 0.9rem;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 80px 20px;
  }

  .empty-icon {
    font-size: 4rem;
    color: var(--gray);
    margin-bottom: 20px;
  }

  .empty-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 10px;
  }

  .empty-text {
    color: var(--text-secondary);
    font-size: 1rem;
    margin-bottom: 30px;
  }

  /* Simple Modern Pagination */
  .simple-pagination {
    margin: 40px auto;
    max-width: 900px;
    padding: 30px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    box-shadow: var(--shadow-lg);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .pagination-info {
    text-align: center;
    margin-bottom: 25px;
    color: var(--text-secondary);
    font-size: 16px;
  }

  .pagination-info strong {
    color: var(--primary);
    font-size: 22px;
    font-weight: 700;
  }

  .pagination-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  .page-link {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 45px;
    height: 45px;
    padding: 0 16px;
    background: var(--light-gray);
    border: 2px solid var(--gray);
    border-radius: 10px;
    color: var(--text-secondary);
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
    cursor: pointer;
  }

  .page-link:hover {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .page-link.active {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    cursor: default;
    pointer-events: none;
  }

  .page-link.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }

  .page-link i {
    font-size: 14px;
  }

  .page-text {
    margin: 0 5px;
  }

  .page-dots {
    color: var(--text-secondary);
    font-weight: 700;
    padding: 0 10px;
  }

  /* Mobile responsive */
  @media (max-width: 640px) {
    .simple-pagination {
      padding: 20px;
    }
    
    .page-link {
      min-width: 38px;
      height: 38px;
      padding: 0 12px;
      font-size: 14px;
    }
    
    .page-text {
      display: none;
    }
    
    .pagination-info {
      font-size: 14px;
    }
    
    .pagination-info strong {
      font-size: 18px;
    }
  }

  /* Statistics Section */
  .stats-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    box-shadow: var(--shadow-lg);
    padding: 40px;
    margin-bottom: 40px;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .stats-title {
    text-align: center;
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 30px;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
  }

  .stat-card {
    background: linear-gradient(135deg, var(--light-gray) 0%, white 100%);
    border: 2px solid var(--gray);
    border-radius: 16px;
    padding: 30px;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary);
  }

  .stat-number {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--primary);
    margin-bottom: 10px;
    display: block;
  }

  .stat-label {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .hero-title {
      font-size: 2.5rem;
    }

    .search-container {
      margin: -40px 20px 40px;
      padding: 30px 20px;
    }

    .advanced-filters {
      grid-template-columns: 1fr;
    }

    .search-actions {
      flex-direction: column;
      width: 100%;
    }

    .btn-search, .btn-clear {
      width: 100%;
      justify-content: center;
    }

    .results-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .decision-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .stats-grid {
      grid-template-columns: 1fr;
    }
  }

  /* Animations */
  .fade-in {
    animation: fadeIn 0.5s ease-in;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .slide-in-left {
    animation: slideInLeft 0.5s ease-out;
  }

  @keyframes slideInLeft {
    from { opacity: 0; transform: translateX(-30px); }
    to { opacity: 1; transform: translateX(0); }
  }
  
  /* Lazy loading animation */
  .decision-card:not(.visible) {
    opacity: 0;
    transform: translateY(20px);
  }
  
  .decision-card {
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    will-change: transform;
    contain: layout style paint;
  }
  
  .decision-card.visible {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Loading skeleton for better perceived performance */
  .skeleton-loader {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
  }
  
  @keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }


  /* Quick Filters */
  .quick-filters {
    background: var(--light-gray);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 30px;
  }

  .quick-filter-label {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .quick-filter-label i {
    color: var(--secondary);
  }

  .filter-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  .filter-chip {
    background: white;
    border: 2px solid var(--gray);
    color: var(--text-primary);
    padding: 8px 16px;
    border-radius: 25px;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .filter-chip:hover {
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
  }

  .filter-chip.active {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
  }

  /* Enhanced Filter Select Styling */
  .filter-select option {
    padding: 8px;
  }

  .filter-input[type="date"] {
    cursor: pointer;
  }

  .filter-input[type="date"]::-webkit-calendar-picker-indicator {
    color: var(--primary);
    cursor: pointer;
  }

  /* Loading and Error States */
  .loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    text-align: center;
  }

  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid var(--light-gray);
    border-top: 4px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .loading-text {
    font-size: 1.1rem;
    color: var(--text-secondary);
    font-weight: 500;
  }

  .empty-state, .error-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    text-align: center;
  }

  .empty-icon, .error-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.7;
  }

  .empty-state h3, .error-state h3 {
    font-size: 1.5rem;
    color: var(--text-primary);
    margin-bottom: 10px;
  }

  .empty-state p, .error-state p {
    font-size: 1rem;
    color: var(--text-secondary);
    max-width: 500px;
    line-height: 1.6;
  }

  .btn-retry {
    background: var(--primary);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 20px;
    transition: background 0.3s ease;
  }

  .btn-retry:hover {
    background: var(--primary-light);
  }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
  <div class="container">
    <div class="hero-content text-center">
      <h1 class="hero-title">‚öñÔ∏è Yargƒ± Kararƒ± Arama Platformu</h1>
      <p class="hero-subtitle">Kapsamlƒ± hukuk veri tabanƒ±nda geli≈ümi≈ü arama teknolojisi ile hƒ±zlƒ± ve doƒüru sonu√ßlara ula≈üƒ±n</p>
      <div class="stats-badge">
        üìä 804796+ Karar ‚Ä¢ üîç AI Destekli Arama ‚Ä¢ ‚ö° Anlƒ±k Sonu√ßlar
      </div>
    </div>
  </div>
</div>

<!-- Advanced Search Container -->
<div class="container">
  <div class="search-container">
    <!-- Search Mode Tabs -->
    <div class="search-tabs">
      <button class="search-tab active" onclick="switchSearchMode('simple')">
        <i class="fas fa-search"></i> Hƒ±zlƒ± Arama
      </button>
      <button class="search-tab" onclick="switchSearchMode('advanced')">
        <i class="fas fa-sliders-h"></i> Geli≈ümi≈ü Filtreler
      </button>
      <a href="{% url 'faiss_query:olay_gir' %}" class="search-tab">
        <i class="fas fa-brain"></i> AI Destekli
      </a>
    </div>

    <!-- Simple Search Form -->
    <form id="simpleSearchForm" class="search-form active">
      <div class="search-input-container">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="simpleSearchInput" class="smart-search-input" 
               name="q" placeholder="Arama terimini girin... (√∂rn: bo≈üanma nafakasƒ±, i≈ü s√∂zle≈ümesi feshi)" 
               value="{{ query }}" autocomplete="off">
      </div>
      <div class="search-actions">
        <button type="submit" class="btn-search">
          <i class="fas fa-search"></i> Ara
        </button>
        <button type="button" class="btn-clear" onclick="clearSearch()">
          <i class="fas fa-times"></i> Temizle
        </button>
      </div>
    </form>

    <!-- Advanced Search Form -->
    <form id="advancedSearchForm" class="search-form">
      <div class="search-input-container">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="advancedSearchInput" class="smart-search-input" 
               name="q" placeholder="Arama terimini girin..." value="{{ query }}">
      </div>
      
      <div class="advanced-filters">
        <!-- Row 1: Basic Filters -->
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-university"></i> Mahkeme T√ºr√º
          </label>
          <select class="filter-select" name="court_type" id="courtTypeFilter">
            <option value="">üèõÔ∏è T√ºm Mahkemeler</option>
            <option value="YARGITAY">‚öñÔ∏è Yargƒ±tay</option>
            <option value="DANI≈ûTAY">üèõÔ∏è Danƒ±≈ütay</option>
            <option value="ANAYASA MAHKEMESƒ∞">üìú Anayasa Mahkemesi</option>
            <option value="SAYI≈ûTAY">üí∞ Sayƒ±≈ütay</option>
            <option value="B√ñLGE ADLƒ∞YE MAHKEMESƒ∞">üè¢ B√∂lge Adliye Mahkemesi</option>
            <option value="KVKK">üîí KVKK</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-layer-group"></i> Daire/Dairem
          </label>
          <select class="filter-select" name="chamber" id="chamberFilter">
            <option value="">T√ºm Daireler</option>
            <!-- Will be populated based on court type -->
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-calendar-alt"></i> Tarih Aralƒ±ƒüƒ±
          </label>
          <select class="filter-select" name="date_range" id="dateRangeFilter">
            <option value="">üìÖ T√ºm Tarihler</option>
            <option value="today">Bug√ºn</option>
            <option value="week">Son 1 Hafta</option>
            <option value="month">Son 1 Ay</option>
            <option value="3months">Son 3 Ay</option>
            <option value="6months">Son 6 Ay</option>
            <option value="year">Son 1 Yƒ±l</option>
            <option value="custom">üóìÔ∏è √ñzel Tarih Aralƒ±ƒüƒ±</option>
          </select>
        </div>
        
        <!-- Row 2: Detailed Filters -->
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-hashtag"></i> Karar Numarasƒ±
          </label>
          <input type="text" class="filter-input" name="decision_number" 
                 placeholder="√ñrn: 2023/1234, 2022/567">
        </div>
        
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-file-alt"></i> Esas Numarasƒ±
          </label>
          <input type="text" class="filter-input" name="case_number" 
                 placeholder="√ñrn: 2023/123, 2022/456">
        </div>
        
        <!-- Row 3: Advanced Search Options -->
        
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-sort-amount-up"></i> Sonu√ß Sƒ±ralama
          </label>
          <select class="filter-select" name="sort_order">
            <option value="relevance">üéØ ƒ∞lgiye G√∂re</option>
            <option value="date_desc">üìÖ En Yeni Tarih</option>
            <option value="date_asc">üìÖ En Eski Tarih</option>
            <option value="court_alpha">üèõÔ∏è Mahkeme A-Z</option>
            <option value="decision_number">üî¢ Karar Numarasƒ±</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label">
            <i class="fas fa-list-ol"></i> Sayfa Ba≈üƒ±na Sonu√ß
          </label>
          <select class="filter-select" name="per_page">
            <option value="20">20 Sonu√ß</option>
            <option value="50">50 Sonu√ß</option>
            <option value="100">100 Sonu√ß</option>
            <option value="200">200 Sonu√ß</option>
          </select>
        </div>
        
        <!-- Custom Date Range (Hidden by default) -->
        <div class="filter-group custom-date-range" id="customDateRange" style="display: none;">
          <label class="filter-label">
            <i class="fas fa-calendar-check"></i> Ba≈ülangƒ±√ß Tarihi
          </label>
          <input type="date" class="filter-input" name="start_date">
        </div>
        
        <div class="filter-group custom-date-range" id="customDateRangeEnd" style="display: none;">
          <label class="filter-label">
            <i class="fas fa-calendar-times"></i> Biti≈ü Tarihi  
          </label>
          <input type="date" class="filter-input" name="end_date">
        </div>
        
        <!-- Search Within Results -->
        <div class="filter-group full-width">
          <label class="filter-label">
            <i class="fas fa-search-plus"></i> Sonu√ßlar ƒ∞√ßinde Ara
          </label>
          <input type="text" class="filter-input" name="within_results" 
                 placeholder="Bulunan sonu√ßlar i√ßinde arama yapƒ±n...">
        </div>
        
        <!-- Exclude Terms -->
        <div class="filter-group full-width">
          <label class="filter-label">
            <i class="fas fa-ban"></i> Hari√ß Tutulacak Kelimeler
          </label>
          <input type="text" class="filter-input" name="exclude_terms" 
                 placeholder="Bu kelimeler i√ßeren sonu√ßlarƒ± hari√ß tut (virg√ºlle ayƒ±rƒ±n)">
        </div>
      </div>
      
      <!-- Quick Filter Chips -->
      <div class="quick-filters">
        <div class="quick-filter-label">
          <i class="fas fa-bolt"></i> Hƒ±zlƒ± Filtreler:
        </div>
        <div class="filter-chips">
          <button type="button" class="filter-chip" onclick="applyQuickFilter('YARGITAY', 'recent')">
            ‚öñÔ∏è Yargƒ±tay (Son 1 Yƒ±l)
          </button>
          <button type="button" class="filter-chip" onclick="applyQuickFilter('DANI≈ûTAY', 'recent')">
            üèõÔ∏è Danƒ±≈ütay (Son 1 Yƒ±l)  
          </button>
          <button type="button" class="filter-chip" onclick="applyQuickFilter('ANAYASA MAHKEMESƒ∞', 'all')">
            üìú Anayasa Mahkemesi
          </button>
          <button type="button" class="filter-chip" onclick="applyQuickFilter('hgk', 'all')">
            ‚öñÔ∏è Hukuk Genel Kurulu
          </button>
          <button type="button" class="filter-chip" onclick="applyQuickFilter('YARGITAY', 'this_year')">
            üìÖ Bu Yƒ±lki Kararlar
          </button>
          <button type="button" class="filter-chip" onclick="applyQuickFilter('all', 'landmark')">
            ‚≠ê Emsal Kararlar
          </button>
        </div>
      </div>
      
      <div class="search-actions">
        <button type="submit" class="btn-search">
          <i class="fas fa-filter"></i> Filtreli Arama
        </button>
        <button type="button" class="btn-clear" onclick="clearAdvancedSearch()">
          <i class="fas fa-undo"></i> Filtreleri Temizle
        </button>
      </div>
    </form>

  </div>
</div>

<!-- Loading Indicator -->
<div id="loadingContainer" class="container" style="display: none;">
  <div class="results-section">
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <div class="loading-text">Arama yapƒ±lƒ±yor...</div>
      <div class="loading-subtext">En alakalƒ± sonu√ßlar getiriliyor</div>
    </div>
  </div>
</div>

<!-- Search Results -->
<div id="resultsContainer" class="container" style="{% if not query %}display: none;{% endif %}">
  <div class="results-section fade-in">
    <div class="results-header">
      <div class="results-info">
        <div class="results-count">{{ total_decisions|default:0 }} sonu√ß</div>
        {% if search_time %}
        <div class="search-time">{{ search_time }} ms</div>
        {% endif %}
        {% if query %}
        <div style="color: var(--gray-600);">"{{ query }}" i√ßin</div>
        {% endif %}
      </div>
      
      <div class="results-controls">
        <select class="sort-select" onchange="handleSortChange(this.value)">
          <option value="relevance">ƒ∞lgiye G√∂re</option>
          <option value="date_desc">En Yeni</option>
          <option value="date_asc">En Eski</option>
          <option value="court">Mahkemeye G√∂re</option>
        </select>
        
        <div class="view-toggle">
          <button class="view-btn active" onclick="switchView('list')">
            <i class="fas fa-list"></i>
          </button>
          <button class="view-btn" onclick="switchView('grid')">
            <i class="fas fa-th"></i>
          </button>
        </div>
      </div>
    </div>
    
    <div id="decisionsContainer" class="decisions-grid">
      <!-- Results will be populated by JavaScript -->
    </div>
    
    <div id="paginationContainer" class="pagination-container" style="display: none;">
      <!-- Pagination will be populated by JavaScript -->
    </div>
  </div>
</div>

<!-- Latest Decisions (when no search) -->
<div id="latestDecisionsContainer" class="container" style="{% if query %}display: none;{% endif %}">
  <div class="results-section slide-in-left">
    <div class="results-header">
      <div class="results-info">
        <div class="results-count">En Yeni Kararlar</div>
        <div style="color: var(--gray-600);">Son eklenen {{ newest_decisions|length }} karar</div>
      </div>
    </div>
    
    <div class="decisions-grid">
      {% for decision in newest_decisions %}
      <div class="decision-card">
        <div class="decision-header">
          <div class="court-info">
            <div class="court-name">{{ decision.karar_veren_mahkeme|upper }}</div>
            <div class="case-number">{{ decision.karar_numarasi|default:"N/A" }} ‚Ä¢ {{ decision.esas_numarasi|default:"N/A" }}</div>
          </div>
          <div class="decision-meta">
            <div class="decision-date">{{ decision.karar_tarihi|default:"Tarih N/A" }}</div>
          </div>
        </div>
        
        <div class="decision-content">
          <div class="decision-summary">{{ decision.karar_ozeti|default:"√ñzet mevcut deƒüil" }}</div>
          {% if decision.anahtar_kelimeler %}
          <div class="keywords">
            {% for keyword in decision.anahtar_kelimeler|slice:":3" %}
            <span class="keyword-tag">{{ keyword }}</span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <div class="decision-actions">
          <a href="{% url 'judicial_detail' decision.id %}" class="btn-detail">
            <i class="fas fa-eye"></i> Detayƒ± G√∂r
          </a>
          <button class="btn-bookmark" onclick="bookmarkDecision({{ decision.id }})">
            <i class="fas fa-bookmark"></i>
          </button>
          <button class="btn-share" onclick="shareDecision({{ decision.id }})">
            <i class="fas fa-share"></i>
          </button>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Statistics Section -->
<div class="container">
  <div class="stats-section">
    <h2 class="stats-title">üìä Platform ƒ∞statistikleri</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <span class="stat-number" data-target="804796">0</span>
        <div class="stat-label">Toplam Karar Sayƒ±sƒ±</div>
      </div>
      
      {% for court_type, count in court_type_counts.items %}
      {% if court_type and court_type|length > 2 %}
      <div class="stat-card">
        <span class="stat-number" data-target="{{ count }}">0</span>
        <div class="stat-label">{{ court_type|title }}</div>
      </div>
      {% endif %}
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
// Global variables
let currentSearchMode = 'simple';
let currentPage = 1;
let currentQuery = '{{ query|escapejs }}';
let currentSort = 'relevance';
let isLoading = false;

// State management functions
function saveSearchState(state) {
    try {
        sessionStorage.setItem('searchState', JSON.stringify(state));
    } catch (e) {
        console.warn('Could not save search state:', e);
    }
}

function restoreSearchState() {
    try {
        const stateStr = sessionStorage.getItem('searchState');
        return stateStr ? JSON.parse(stateStr) : null;
    } catch (e) {
        console.warn('Could not restore search state:', e);
        return null;
    }
}

function getSearchCache(key) {
    try {
        const cached = sessionStorage.getItem(key);
        return cached ? JSON.parse(cached) : null;
    } catch (e) {
        console.warn('Could not get search cache:', e);
        return null;
    }
}

function setSearchCache(key, data) {
    try {
        sessionStorage.setItem(key, JSON.stringify(data));
    } catch (e) {
        console.warn('Could not set search cache:', e);
    }
}

function updateURL(query, page) {
    const url = new URL(window.location);
    if (query) {
        url.searchParams.set('q', query);
    } else {
        url.searchParams.delete('q');
    }
    if (page > 1) {
        url.searchParams.set('page', page);
    } else {
        url.searchParams.delete('page');
    }
    
    // Update URL without reloading page
    window.history.replaceState({
        query: query,
        page: page,
        sort: currentSort,
        scrollPosition: window.scrollY
    }, '', url.toString());
}

// UI utility functions
function showLoading() {
    const resultsContainer = document.getElementById('resultsContainer');
    const decisionsContainer = document.getElementById('decisionsContainer');
    
    if (resultsContainer) {
        resultsContainer.style.display = 'block';
    }
    
    if (decisionsContainer) {
        decisionsContainer.innerHTML = `
            <div class="loading-state">
                <div class="loading-spinner"></div>
                <div class="loading-text">Aranƒ±yor...</div>
            </div>
        `;
    }
}

function hideLoading() {
    // Loading is hidden when results are displayed
}

function hideLatestDecisions() {
    const latestContainer = document.getElementById('latestDecisionsContainer');
    if (latestContainer) {
        latestContainer.style.display = 'none';
    }
}

function displayEmptyState() {
    const container = document.getElementById('decisionsContainer');
    const resultsContainer = document.getElementById('resultsContainer');
    
    if (container) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üîç</div>
                <h3>Sonu√ß bulunamadƒ±</h3>
                <p>Arama kriterlerinize uygun karar bulunamadƒ±. L√ºtfen farklƒ± anahtar kelimeler deneyin.</p>
            </div>
        `;
    }
    
    if (resultsContainer) {
        resultsContainer.style.display = 'block';
    }
    
    // Hide pagination
    const paginationContainer = document.getElementById('paginationContainer');
    if (paginationContainer) {
        paginationContainer.style.display = 'none';
    }
}

function displayError(message) {
    const container = document.getElementById('decisionsContainer');
    const resultsContainer = document.getElementById('resultsContainer');
    
    if (container) {
        container.innerHTML = `
            <div class="error-state">
                <div class="error-icon">‚ö†Ô∏è</div>
                <h3>Hata olu≈ütu</h3>
                <p>${message}</p>
                <button onclick="location.reload()" class="btn-retry">Tekrar Dene</button>
            </div>
        `;
    }
    
    if (resultsContainer) {
        resultsContainer.style.display = 'block';
    }
}

function detectSearchModeFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    
    // Advanced search parameters that indicate advanced mode
    const advancedParams = ['court_type', 'chamber', 'date_range', 'decision_number', 'case_number', 'sort_order', 'per_page', 'within_results', 'exclude_terms'];
    
    // Check if any advanced parameters are present
    const hasAdvancedParams = advancedParams.some(param => urlParams.get(param));
    
    if (hasAdvancedParams) {
        console.log('Advanced search parameters detected in URL, switching to advanced mode');
        currentSearchMode = 'advanced';
        localStorage.setItem('currentSearchMode', 'advanced');
    } else {
        console.log('No advanced parameters detected, staying in simple mode');
        currentSearchMode = 'simple';
        localStorage.setItem('currentSearchMode', 'simple');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Detect search mode from URL parameters first
    detectSearchModeFromURL();
    
    initializeApp();
    
    // Handle browser back/forward navigation
    window.addEventListener('popstate', function(event) {
        if (event.state) {
            // Restore from state
            currentQuery = event.state.query || '';
            currentPage = event.state.page || 1;
            currentSort = event.state.sort || 'relevance';
            
            // Update search inputs
            document.getElementById('simpleSearchInput').value = currentQuery;
            document.getElementById('advancedSearchInput').value = currentQuery;
            
            // Perform search with cache
            if (currentQuery) {
                performSearch(currentQuery, currentPage, true);
                
                // Restore scroll position after a short delay
                setTimeout(() => {
                    if (event.state.scrollPosition) {
                        window.scrollTo(0, event.state.scrollPosition);
                    }
                }, 100);
            }
        } else {
            // Check URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const query = urlParams.get('q');
            const page = parseInt(urlParams.get('page')) || 1;
            const sort = urlParams.get('sort') || 'relevance';
            
            if (query) {
                currentQuery = query;
                currentPage = page;
                currentSort = sort;
                performSearch(query, page, true);
            }
        }
    });
    
    // Check if returning to page (e.g., from detail page)
    if (window.performance.navigation.type === 2) {
        // Browser back button was used
        const lastState = restoreSearchState();
        if (lastState) {
            currentQuery = lastState.query;
            currentPage = lastState.page;
            currentSort = lastState.sort;
            currentSearchMode = lastState.searchMode || currentSearchMode;
            
            // Update search inputs
            document.getElementById('simpleSearchInput').value = currentQuery;
            document.getElementById('advancedSearchInput').value = currentQuery;
            
            // Restore search mode
            switchSearchMode(currentSearchMode);
            
            // Restore advanced form data if available
            if (lastState.formData && currentSearchMode === 'advanced') {
                restoreAdvancedFormData(lastState.formData);
                const form = document.getElementById('advancedSearchForm');
                const formData = new FormData(form);
                performAdvancedSearch(currentQuery, formData, currentPage);
            } else {
                // Restore search results from cache
                performSearch(currentQuery, currentPage, true);
            }
            
            // Restore scroll position
            setTimeout(() => {
                window.scrollTo(0, lastState.scrollPosition || 0);
            }, 100);
            
            return;
        }
    }
    
    // Normal page load - check URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q') || currentQuery;
    const page = parseInt(urlParams.get('page')) || 1;
    const sort = urlParams.get('sort') || 'relevance';
    
    // Check for advanced search parameters
    const hasAdvancedParams = ['court_type', 'chamber', 'date_range', 'decision_number', 'case_number'].some(param => urlParams.get(param));
    
    if (query || hasAdvancedParams) {
        currentQuery = query;
        currentPage = page;
        currentSort = sort;
        
        if (hasAdvancedParams) {
            currentSearchMode = 'advanced';
            switchSearchMode('advanced');
            restoreAdvancedFormFromURL(urlParams);
            const form = document.getElementById('advancedSearchForm');
            const formData = new FormData(form);
            performAdvancedSearch(query, formData, page);
        } else {
            performSearch(query, page);
        }
    }
});

function initializeApp() {
    // Restore search mode from localStorage
    const savedMode = localStorage.getItem('currentSearchMode');
    if (savedMode && (savedMode === 'simple' || savedMode === 'advanced')) {
        currentSearchMode = savedMode;
        // Update UI to reflect the saved mode
        switchSearchMode(savedMode);
    }
    
    // Initialize form handlers
    setupSearchForms();
    
    // Initialize counter animations
    animateCounters();
    
    // Initialize autocomplete
    initializeAutocomplete();
    
    // Initialize dynamic filters
    initializeDynamicFilters();
    
    // Initialize quick filters
    initializeQuickFilters();
    
    // Initialize page jump Enter key handler
    initializePageJumpHandler();
}

function setupSearchForms() {
    const forms = ['simpleSearchForm', 'advancedSearchForm'];
    
    forms.forEach(formId => {
        const form = document.getElementById(formId);
        if (form) {
            form.addEventListener('submit', handleFormSubmit);
        }
    });
}

function handleFormSubmit(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    let query = formData.get('q') || '';
    
    // Check which form was submitted
    const formId = e.target.id;
    
    if (formId === 'simpleSearchForm' || currentSearchMode === 'simple') {
        if (query.trim()) {
            performSearch(query.trim(), 1);
        }
    } else if (formId === 'advancedSearchForm' || currentSearchMode === 'advanced') {
        // Advanced search: use AJAX like simple search
        // Ensure we have at least a query or some filter
        const hasQuery = query.trim();
        const hasFilters = Array.from(formData.entries()).some(([key, value]) => 
            key !== 'q' && value && value.trim()
        );
        
        if (hasQuery || hasFilters) {
            performAdvancedSearch(query, formData, 1);
        } else {
            alert('L√ºtfen en azƒ±ndan bir arama terimi veya filtre se√ßin.');
        }
    }
}

function switchSearchMode(mode) {
    console.log('Switching to search mode:', mode); // Debug log
    currentSearchMode = mode;
    
    // Save the current mode to localStorage for persistence
    localStorage.setItem('currentSearchMode', mode);
    
    // Update tab states
    document.querySelectorAll('.search-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Find the clicked tab and add active class
    const clickedTab = document.querySelector(`.search-tab[onclick*="${mode}"]`);
    if (clickedTab) {
        clickedTab.classList.add('active');
    }
    
    // Update form visibility
    document.querySelectorAll('.search-form').forEach(form => {
        form.classList.remove('active');
    });
    
    const activeForm = mode + 'SearchForm';
    const targetForm = document.getElementById(activeForm);
    if (targetForm) {
        targetForm.classList.add('active');
        console.log('Activated form:', activeForm); // Debug log
    } else {
        console.error('Form not found:', activeForm); // Debug log
    }
}

function performSearch(query, page = 1, useCache = false) {
    if (isLoading) return;
    
    isLoading = true;
    currentQuery = query;
    currentPage = page;
    
    // Create cache key
    const cacheKey = `search_${query}_${page}_${currentSort}`;
    
    // Check cache first if useCache is true or browser back/forward navigation
    if (useCache || window.performance.navigation.type === 2) {
        const cachedData = getSearchCache(cacheKey);
        if (cachedData) {
            displayResults(cachedData);
            hideLoading();
            isLoading = false;
            return;
        }
    }
    
    // Show loading state
    showLoading();
    
    // Hide other sections
    hideLatestDecisions();
    
    // Update URL and save state
    updateURL(query, page);
    
    // Make AJAX request
    const searchParams = new URLSearchParams({
        q: query,
        page: page,
        sort: currentSort
    });
    
    fetch(`/judicial-search/?${searchParams.toString()}`, {
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        // Cache the results
        setSearchCache(cacheKey, data);
        
        // Save search state
        saveSearchState({
            query: query,
            page: page,
            sort: currentSort,
            scrollPosition: window.scrollY
        });
        
        displayResults(data);
    })
    .catch(error => {
        console.error('Search error:', error);
        displayError('Arama sƒ±rasƒ±nda bir hata olu≈ütu. L√ºtfen tekrar deneyin.');
    })
    .finally(() => {
        hideLoading();
        isLoading = false;
    });
}


function displayResults(data) {
    // Hide loading state immediately when starting to display results
    hideLoading();
    
    // DEBUG: Log the received data
    console.log('DEBUG - Received data:', data);
    console.log('DEBUG - Results array:', data.results);
    console.log('DEBUG - Results length:', data.results ? data.results.length : 'undefined');
    console.log('DEBUG - Total decisions:', data.total_decisions);
    
    const container = document.getElementById('decisionsContainer');
    const resultsContainer = document.getElementById('resultsContainer');
    
    if (!data.results || data.results.length === 0) {
        console.log('DEBUG - No results found, showing empty state');
        displayEmptyState();
        return;
    }
    
    console.log('DEBUG - Displaying', data.results.length, 'results');
    
    // Update results count and stats
    updateResultsHeader(data);
    
    // Use DocumentFragment for better performance
    const fragment = document.createDocumentFragment();
    const tempDiv = document.createElement('div');
    
    // Generate results HTML
    let html = '';
    data.results.forEach(decision => {
        html += generateDecisionCard(decision);
    });
    
    tempDiv.innerHTML = html;
    
    // Move all children to fragment
    while (tempDiv.firstChild) {
        fragment.appendChild(tempDiv.firstChild);
    }
    
    // Clear container and append fragment (single DOM operation)
    container.innerHTML = '';
    container.appendChild(fragment);
    
    // Update pagination
    updatePagination(data.pagination);
    
    // Show results container
    resultsContainer.style.display = 'block';
    
    // Only scroll if not using cache (new search)
    const cacheKey = `search_${currentQuery}_${currentPage}_${currentSort}`;
    const wasCached = sessionStorage.getItem(cacheKey) !== null;
    
    if (!wasCached) {
        resultsContainer.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Save current scroll position for future navigation
    setTimeout(() => {
        saveSearchState({
            query: currentQuery,
            page: currentPage,
            sort: currentSort,
            scrollPosition: window.scrollY
        });
        
        // Initialize lazy loading for performance
        initializeLazyLoading();
        
        // Preload next page for better UX
        preloadNextPage();
    }, 100);
}

function generateDecisionCard(decision) {
    const keywords = decision.anahtar_kelimeler ? 
        decision.anahtar_kelimeler.split(',').slice(0, 3).map(k => 
            `<span class="keyword-tag">${k.trim()}</span>`
        ).join('') : '';
        
    return `
        <div class="decision-card fade-in">
            <div class="decision-header">
                <div class="court-info">
                    <div class="court-name">${decision.karar_veren_mahkeme.toUpperCase()}</div>
                    <div class="case-number">${decision.karar_numarasi || 'N/A'} ‚Ä¢ ${decision.esas_numarasi || 'N/A'}</div>
                </div>
                <div class="decision-meta">
                    ${decision.relevance_score ? `<div class="relevance-score">Skor: ${decision.relevance_score.toFixed(3)}</div>` : ''}
                    <div class="decision-date">${decision.karar_tarihi || 'Tarih N/A'}</div>
                </div>
            </div>
            
            <div class="decision-content">
                <div class="decision-summary">${decision.karar_ozeti || '√ñzet mevcut deƒüil'}</div>
                <div class="keywords">${keywords}</div>
            </div>
            
            <div class="decision-actions">
                <a href="/judicial/${decision.id}/" class="btn-detail" onclick="saveCurrentState()">
                    <i class="fas fa-eye"></i> Detayƒ± G√∂r
                </a>
                <button class="btn-bookmark" onclick="bookmarkDecision(${decision.id})">
                    <i class="fas fa-bookmark"></i>
                </button>
                <button class="btn-share" onclick="shareDecision(${decision.id})">
                    <i class="fas fa-share"></i>
                </button>
            </div>
        </div>
    `;
}

function updateResultsHeader(data) {
    const countElement = document.querySelector('.results-count');
    const timeElement = document.querySelector('.search-time');
    
    if (countElement) {
        countElement.textContent = `${data.total_decisions} sonu√ß`;
    }
    
    if (timeElement && data.search_time) {
        timeElement.textContent = `${data.search_time} ms`;
    }
}

function updatePagination(pagination) {
    const container = document.getElementById('paginationContainer');
    
    if (!pagination || pagination.total_pages <= 1) {
        container.style.display = 'none';
        return;
    }
    
    // Calculate displayed items range
    const perPage = pagination.per_page || 20;
    const startItem = (pagination.current_page - 1) * perPage + 1;
    const endItem = Math.min(pagination.current_page * perPage, pagination.total_results);
    
    let html = '<div class="simple-pagination">';
    
    // Info section
    html += `
        <div class="pagination-info">
            <strong>${pagination.total_results.toLocaleString('tr-TR')}</strong> sonu√ß bulundu
            <br>
            <span style="font-size: 14px; color: #718096;">
                G√∂sterilen: ${startItem}-${endItem} | Sayfa ${pagination.current_page} / ${pagination.total_pages}
            </span>
        </div>
    `;
    
    // Controls section
    html += '<div class="pagination-controls">';
    
    // Previous button
    if (pagination.has_previous) {
        html += `
            <a href="#" class="page-link" onclick="handlePaginationClick(${pagination.current_page - 1}); return false;">
                <i class="fas fa-chevron-left"></i>
                <span class="page-text">√ñnceki</span>
            </a>
        `;
    } else {
        html += `
            <span class="page-link disabled">
                <i class="fas fa-chevron-left"></i>
                <span class="page-text">√ñnceki</span>
            </span>
        `;
    }
    
    // Page numbers
    const maxVisible = 5; // Maximum visible page numbers
    let startPage = Math.max(1, pagination.current_page - 2);
    let endPage = Math.min(pagination.total_pages, pagination.current_page + 2);
    
    // Adjust range
    if (endPage - startPage < maxVisible - 1) {
        if (startPage === 1) {
            endPage = Math.min(maxVisible, pagination.total_pages);
        } else {
            startPage = Math.max(1, pagination.total_pages - maxVisible + 1);
        }
    }
    
    // First page and dots
    if (startPage > 1) {
        html += `<a href="#" class="page-link" onclick="handlePaginationClick(1); return false;">1</a>`;
        if (startPage > 2) {
            html += '<span class="page-dots">...</span>';
        }
    }
    
    // Page numbers
    for (let i = startPage; i <= endPage; i++) {
        if (i === pagination.current_page) {
            html += `<span class="page-link active">${i}</span>`;
        } else {
            html += `<a href="#" class="page-link" onclick="handlePaginationClick(${i}); return false;">${i}</a>`;
        }
    }
    
    // Last page and dots
    if (endPage < pagination.total_pages) {
        if (endPage < pagination.total_pages - 1) {
            html += '<span class="page-dots">...</span>';
        }
        html += `<a href="#" class="page-link" onclick="handlePaginationClick(${pagination.total_pages}); return false;">${pagination.total_pages}</a>`;
    }
    
    // Next button
    if (pagination.has_next) {
        html += `
            <a href="#" class="page-link" onclick="handlePaginationClick(${pagination.current_page + 1}); return false;">
                <span class="page-text">Sonraki</span>
                <i class="fas fa-chevron-right"></i>
            </a>
        `;
    } else {
        html += `
            <span class="page-link disabled">
                <span class="page-text">Sonraki</span>
                <i class="fas fa-chevron-right"></i>
            </span>
        `;
    }
    
    html += '</div>'; // Close controls
    html += '</div>'; // Close simple-pagination
    
    container.innerHTML = html;
    container.style.display = 'block';
}

function displayEmptyState() {
    // Hide loading state when showing empty results
    hideLoading();
    
    const container = document.getElementById('decisionsContainer');
    container.innerHTML = `
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-search"></i>
            </div>
            <div class="empty-title">Sonu√ß bulunamadƒ±</div>
            <div class="empty-text">
                Arama kriterlerinizi deƒüi≈ütirip tekrar deneyin.<br>
                Daha genel terimler kullanmayƒ± deneyebilirsiniz.
            </div>
            <button class="btn-search" onclick="clearSearch()">
                <i class="fas fa-redo"></i> Yeni Arama
            </button>
        </div>
    `;
    
    document.getElementById('resultsContainer').style.display = 'block';
    document.getElementById('paginationContainer').style.display = 'none';
}

function displayError(message) {
    // Hide loading state when showing error
    hideLoading();
    
    const container = document.getElementById('decisionsContainer');
    container.innerHTML = `
        <div class="empty-state">
            <div class="empty-icon" style="color: var(--danger-red);">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="empty-title">Hata Olu≈ütu</div>
            <div class="empty-text">${message}</div>
            <button class="btn-search" onclick="location.reload()">
                <i class="fas fa-redo"></i> Sayfayƒ± Yenile
            </button>
        </div>
    `;
    
    document.getElementById('resultsContainer').style.display = 'block';
}

function showLoading() {
    document.getElementById('loadingContainer').style.display = 'block';
}

function hideLoading() {
    document.getElementById('loadingContainer').style.display = 'none';
}

function hideLatestDecisions() {
    document.getElementById('latestDecisionsContainer').style.display = 'none';
}

function updateURL(query, page) {
    const url = new URL(window.location);
    url.searchParams.set('q', query);
    url.searchParams.set('page', page);
    url.searchParams.set('sort', currentSort);
    
    // Save state with history API
    const state = {
        query: query,
        page: page,
        sort: currentSort,
        scrollPosition: window.scrollY
    };
    
    window.history.pushState(state, '', url);
}

// Cache management functions
function setSearchCache(key, data) {
    try {
        // Add timestamp to cache
        const cacheData = {
            timestamp: Date.now(),
            data: data
        };
        
        // Store in sessionStorage (survives page reload but not new tabs)
        sessionStorage.setItem(key, JSON.stringify(cacheData));
        
        // Clean up old cache entries (keep only last 50 searches)
        cleanupSearchCache();
    } catch (e) {
        console.warn('Failed to cache search results:', e);
    }
}

function getSearchCache(key) {
    try {
        const cached = sessionStorage.getItem(key);
        if (!cached) return null;
        
        const cacheData = JSON.parse(cached);
        
        // Cache expires after 30 minutes
        const cacheExpiry = 30 * 60 * 1000; // 30 minutes
        if (Date.now() - cacheData.timestamp > cacheExpiry) {
            sessionStorage.removeItem(key);
            return null;
        }
        
        return cacheData.data;
    } catch (e) {
        console.warn('Failed to retrieve cached results:', e);
        return null;
    }
}

function cleanupSearchCache() {
    try {
        // Get all cache keys
        const cacheKeys = [];
        for (let i = 0; i < sessionStorage.length; i++) {
            const key = sessionStorage.key(i);
            if (key && key.startsWith('search_')) {
                cacheKeys.push(key);
            }
        }
        
        // If more than 50 cached searches, remove oldest ones
        if (cacheKeys.length > 50) {
            // Get cache entries with timestamps
            const cacheEntries = cacheKeys.map(key => {
                try {
                    const data = JSON.parse(sessionStorage.getItem(key));
                    return { key, timestamp: data.timestamp || 0 };
                } catch (e) {
                    return { key, timestamp: 0 };
                }
            });
            
            // Sort by timestamp (oldest first)
            cacheEntries.sort((a, b) => a.timestamp - b.timestamp);
            
            // Remove oldest entries
            const toRemove = cacheEntries.length - 50;
            for (let i = 0; i < toRemove; i++) {
                sessionStorage.removeItem(cacheEntries[i].key);
            }
        }
    } catch (e) {
        console.warn('Failed to cleanup cache:', e);
    }
}

// Save search state
function saveSearchState(state) {
    try {
        sessionStorage.setItem('lastSearchState', JSON.stringify(state));
    } catch (e) {
        console.warn('Failed to save search state:', e);
    }
}

// Restore search state
function restoreSearchState() {
    try {
        const stateStr = sessionStorage.getItem('lastSearchState');
        if (stateStr) {
            return JSON.parse(stateStr);
        }
    } catch (e) {
        console.warn('Failed to restore search state:', e);
    }
    return null;
}

function handleSortChange(sortType) {
    currentSort = sortType;
    if (currentQuery) {
        performSearch(currentQuery, 1);
    }
}

function switchView(viewType) {
    // Update view toggle buttons
    document.querySelectorAll('.view-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Apply view styles (implementation depends on requirements)
    const container = document.getElementById('decisionsContainer');
    if (viewType === 'grid') {
        container.style.display = 'grid';
        container.style.gridTemplateColumns = 'repeat(auto-fit, minmax(400px, 1fr))';
        container.style.gap = '20px';
    } else {
        container.style.display = 'block';
        container.style.gridTemplateColumns = 'none';
        container.style.gap = 'normal';
    }
}

function clearSearch() {
    document.getElementById('simpleSearchInput').value = '';
    document.getElementById('advancedSearchInput').value = '';
    currentQuery = '';
    
    // Hide results and show latest decisions
    document.getElementById('resultsContainer').style.display = 'none';
    document.getElementById('latestDecisionsContainer').style.display = 'block';
    
    // Update URL
    window.history.pushState({}, '', window.location.pathname);
}

function clearAdvancedSearch() {
    const form = document.getElementById('advancedSearchForm');
    form.reset();
}

function jumpToPage() {
    const input = document.getElementById('pageJumpInput');
    const page = parseInt(input.value);
    const maxPage = parseInt(input.max);
    
    if (page >= 1 && page <= maxPage) {
        performSearch(currentQuery, page);
    } else {
        alert('Ge√ßersiz sayfa numarasƒ±!');
        input.value = currentPage; // Reset to current page
    }
}

// Event listener for Enter key on page jump input
document.addEventListener('keydown', function(e) {
    if (e.target && e.target.id === 'pageJumpInput' && e.key === 'Enter') {
        e.preventDefault();
        jumpToPage();
    }
});

function initializePageJumpHandler() {
    // Add event listener for Enter key on page jump input
    // This will be called every time pagination is updated
    document.addEventListener('keydown', function(e) {
        if (e.target && e.target.id === 'pageJumpInput' && e.key === 'Enter') {
            e.preventDefault();
            jumpToPage();
        }
    });
}


function bookmarkDecision(decisionId) {
    // Implementation for bookmarking
    console.log('Bookmark decision:', decisionId);
    // Could save to localStorage or make API call
}

function shareDecision(decisionId) {
    // Implementation for sharing
    const url = `${window.location.origin}/judicial/${decisionId}/`;
    
    if (navigator.share) {
        navigator.share({
            title: 'Yargƒ± Kararƒ±',
            url: url
        });
    } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(url).then(() => {
            alert('Link kopyalandƒ±!');
        });
    }
}

function animateCounters() {
    const counters = document.querySelectorAll('.stat-number');
    const speed = 100;

    counters.forEach(counter => {
        const updateCount = () => {
            const target = +counter.getAttribute('data-target');
            const count = +counter.innerText;
            const increment = target / speed;

            if (count < target) {
                counter.innerText = Math.ceil(count + increment);
                setTimeout(updateCount, 15);
            } else {
                counter.innerText = target.toLocaleString();
            }
        };

        updateCount();
    });
}

function initializeAutocomplete() {
    // Simple autocomplete implementation
    const searchInputs = ['simpleSearchInput', 'advancedSearchInput'];
    
    searchInputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
            // Add autocomplete suggestions (would typically fetch from API)
            input.addEventListener('input', function() {
                // Implementation for autocomplete suggestions
            });
        }
    });
}

function initializeDynamicFilters() {
    // Court type change handler
    const courtTypeFilter = document.getElementById('courtTypeFilter');
    const chamberFilter = document.getElementById('chamberFilter');
    const dateRangeFilter = document.getElementById('dateRangeFilter');
    
    if (courtTypeFilter) {
        courtTypeFilter.addEventListener('change', function() {
            updateChamberOptions(this.value);
        });
    }
    
    // Date range custom handler
    if (dateRangeFilter) {
        dateRangeFilter.addEventListener('change', function() {
            toggleCustomDateRange(this.value === 'custom');
        });
    }
}

function updateChamberOptions(courtType) {
    const chamberFilter = document.getElementById('chamberFilter');
    if (!chamberFilter) return;
    
    // Clear existing options
    chamberFilter.innerHTML = '<option value="">T√ºm Daireler</option>';
    
    const chamberOptions = {
        'yargitay': [
            '1. Hukuk Dairesi', '2. Hukuk Dairesi', '3. Hukuk Dairesi', '4. Hukuk Dairesi',
            '5. Hukuk Dairesi', '6. Hukuk Dairesi', '7. Hukuk Dairesi', '8. Hukuk Dairesi',
            '9. Hukuk Dairesi', '10. Hukuk Dairesi', '11. Hukuk Dairesi', '12. Hukuk Dairesi',
            '13. Hukuk Dairesi', '14. Hukuk Dairesi', '15. Hukuk Dairesi',
            '1. Ceza Dairesi', '2. Ceza Dairesi', '3. Ceza Dairesi', '4. Ceza Dairesi',
            '5. Ceza Dairesi', '6. Ceza Dairesi', '7. Ceza Dairesi', '8. Ceza Dairesi',
            'Hukuk Genel Kurulu', 'Ceza Genel Kurulu', 'B√ºy√ºk Genel Kurul'
        ],
        'danistay': [
            'Birinci Daire', 'ƒ∞kinci Daire', '√ú√ß√ºnc√º Daire', 'D√∂rd√ºnc√º Daire',
            'Be≈üinci Daire', 'Altƒ±ncƒ± Daire', 'Yedinci Daire', 'Sekizinci Daire',
            'Dokuzuncu Daire', 'Onuncu Daire', 'On Birinci Daire', 'On ƒ∞kinci Daire',
            'On √ú√ß√ºnc√º Daire', 'On D√∂rd√ºnc√º Daire', 'On Be≈üinci Daire',
            'ƒ∞dari Dava Daireleri Kurulu', 'Vergi Dava Daireleri Kurulu', 'Dava Daireleri Genel Kurulu'
        ],
        'aym': [
            'Birinci B√∂l√ºm', 'ƒ∞kinci B√∂l√ºm', '√ú√ß√ºnc√º B√∂l√ºm', 'Genel Kurul'
        ],
        'sayistay': [
            'Birinci Daire', 'ƒ∞kinci Daire', '√ú√ß√ºnc√º Daire', 'D√∂rd√ºnc√º Daire',
            'Be≈üinci Daire', 'Altƒ±ncƒ± Daire', 'Genel Kurul'
        ],
        'bolge': [
            'Hukuk Dairesi', 'Ceza Dairesi', 'Ticaret Dairesi', 
            'Aile Dairesi', 'ƒ∞≈ü Dairesi', 'ƒ∞dare Dairesi'
        ]
    };
    
    if (chamberOptions[courtType]) {
        chamberOptions[courtType].forEach(chamber => {
            const option = document.createElement('option');
            option.value = chamber;
            option.textContent = chamber;
            chamberFilter.appendChild(option);
        });
    }
}

function toggleCustomDateRange(show) {
    const customDateRange = document.getElementById('customDateRange');
    const customDateRangeEnd = document.getElementById('customDateRangeEnd');
    
    if (customDateRange && customDateRangeEnd) {
        customDateRange.style.display = show ? 'block' : 'none';
        customDateRangeEnd.style.display = show ? 'block' : 'none';
    }
}

function initializeQuickFilters() {
    // Quick filter functionality handled by onclick events in HTML
    const filterChips = document.querySelectorAll('.filter-chip');
    
    filterChips.forEach(chip => {
        chip.addEventListener('click', function() {
            // Toggle active state
            this.classList.toggle('active');
        });
    });
}

function applyQuickFilter(courtType, timeRange) {
    // Clear existing filters
    clearAdvancedSearch();
    
    // Apply court type filter
    const courtTypeFilter = document.getElementById('courtTypeFilter');
    if (courtTypeFilter && courtType !== 'all') {
        courtTypeFilter.value = courtType;
        updateChamberOptions(courtType);
    }
    
    // Apply time range filter
    const dateRangeFilter = document.getElementById('dateRangeFilter');
    if (dateRangeFilter && timeRange !== 'all') {
        switch(timeRange) {
            case 'recent':
                dateRangeFilter.value = 'last_year';
                break;
            case 'this_year':
                dateRangeFilter.value = 'last_year';
                break;
            case 'landmark':
                // Apply special filter for landmark cases
                const keywordFilter = document.querySelector('select[name="keyword_type"]');
                if (keywordFilter) {
                    keywordFilter.value = 'legal_terms';
                }
                break;
        }
    }
    
    // Special handling for Hukuk Genel Kurulu
    if (courtType === 'hgk') {
        courtTypeFilter.value = 'yargitay';
        updateChamberOptions('yargitay');
        const chamberFilter = document.getElementById('chamberFilter');
        if (chamberFilter) {
            chamberFilter.value = 'Hukuk Genel Kurulu';
        }
    }
    
    // Update active chip state
    document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Automatically perform search if there's a query
    if (currentQuery) {
        const form = document.getElementById('advancedSearchForm');
        const formData = new FormData(form);
        const query = formData.get('q') || currentQuery;
        performAdvancedSearch(query, formData);
    }
}

function performAdvancedSearch(query, formData, page = 1) {
    if (isLoading) return;
    
    isLoading = true;
    currentQuery = query;
    currentPage = page;
    
    // Show loading state
    showLoading();
    hideLatestDecisions();
    
    // Build search parameters
    const searchParams = new URLSearchParams();
    searchParams.set('q', query);
    searchParams.set('page', page);
    
    // Add all form data to search params
    for (let [key, value] of formData.entries()) {
        if (value && value.trim()) {
            searchParams.set(key, value);
        }
    }
    
    // Update URL and save state
    updateURL(query, page);
    
    // Make AJAX request
    fetch(`/judicial-search/?${searchParams.toString()}`, {
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        displayResults(data);
    })
    .catch(error => {
        console.error('Advanced search error:', error);
        displayError('Geli≈ümi≈ü arama sƒ±rasƒ±nda bir hata olu≈ütu. L√ºtfen tekrar deneyin.');
    })
    .finally(() => {
        hideLoading();
        isLoading = false;
    });
}

function clearAdvancedSearch() {
    const form = document.getElementById('advancedSearchForm');
    if (form) {
        form.reset();
        toggleCustomDateRange(false);
        
        // Reset chamber options
        const chamberFilter = document.getElementById('chamberFilter');
        if (chamberFilter) {
            chamberFilter.innerHTML = '<option value="">T√ºm Daireler</option>';
        }
        
        // Clear quick filter states
        document.querySelectorAll('.filter-chip').forEach(chip => {
            chip.classList.remove('active');
        });
    }
}

function handlePaginationClick(page) {
    if (currentSearchMode === 'simple') {
        performSearch(currentQuery, page);
    } else if (currentSearchMode === 'advanced') {
        const form = document.getElementById('advancedSearchForm');
        const formData = new FormData(form);
        performAdvancedSearch(currentQuery, formData, page);
    }
}

// Save current state before navigating away
function saveCurrentState() {
    const state = {
        query: currentQuery,
        page: currentPage,
        sort: currentSort,
        searchMode: currentSearchMode,
        scrollPosition: window.scrollY
    };
    
    // If advanced search mode, save form data
    if (currentSearchMode === 'advanced') {
        const form = document.getElementById('advancedSearchForm');
        if (form) {
            const formData = new FormData(form);
            const formDataObj = {};
            for (let [key, value] of formData.entries()) {
                if (value && value.trim()) {
                    formDataObj[key] = value;
                }
            }
            state.formData = formDataObj;
        }
    }
    
    saveSearchState(state);
}

// Debounce function for performance
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Add scroll position saving on scroll (debounced)
const debouncedSaveScrollPosition = debounce(() => {
    if (currentQuery) {
        saveSearchState({
            query: currentQuery,
            page: currentPage,
            sort: currentSort,
            scrollPosition: window.scrollY
        });
    }
}, 300);

// Save scroll position periodically
window.addEventListener('scroll', debouncedSaveScrollPosition);

// Keyboard navigation support
document.addEventListener('keydown', function(e) {
    // Only handle if search results are visible
    if (document.getElementById('resultsContainer').style.display === 'none') return;
    
    // Alt + Left Arrow: Previous page
    if (e.altKey && e.key === 'ArrowLeft') {
        e.preventDefault();
        const prevButton = document.querySelector('.page-link:not(.disabled):first-child');
        if (prevButton && prevButton.onclick) {
            prevButton.click();
        }
    }
    
    // Alt + Right Arrow: Next page
    if (e.altKey && e.key === 'ArrowRight') {
        e.preventDefault();
        const nextButton = document.querySelector('.page-link:not(.disabled):last-child');
        if (nextButton && nextButton.onclick) {
            nextButton.click();
        }
    }
    
    // Ctrl/Cmd + F: Focus search input
    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
        e.preventDefault();
        const searchInput = document.getElementById(currentSearchMode === 'simple' ? 'simpleSearchInput' : 'advancedSearchInput');
        if (searchInput) {
            searchInput.focus();
            searchInput.select();
        }
    }
});

// Performance optimization: Use Intersection Observer for lazy loading
function initializeLazyLoading() {
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const card = entry.target;
                    card.classList.add('visible');
                    observer.unobserve(card);
                }
            });
        }, {
            rootMargin: '50px 0px',
            threshold: 0.01
        });

        // Observe all decision cards
        setTimeout(() => {
            document.querySelectorAll('.decision-card').forEach(card => {
                imageObserver.observe(card);
            });
        }, 100);
    }
}

// Preload next page for better performance
function preloadNextPage() {
    if (currentQuery && currentPage < 10) { // Only preload first 10 pages
        const nextPage = currentPage + 1;
        const cacheKey = `search_${currentQuery}_${nextPage}_${currentSort}`;
        
        // Check if already cached
        if (!sessionStorage.getItem(cacheKey)) {
            const searchParams = new URLSearchParams({
                q: currentQuery,
                page: nextPage,
                sort: currentSort
            });
            
            // Preload in background (low priority)
            setTimeout(() => {
                fetch(`/judicial-search/?${searchParams.toString()}`, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    setSearchCache(cacheKey, data);
                })
                .catch(() => {
                    // Silently fail for preload
                });
            }, 2000); // Wait 2 seconds before preloading
        }
    }
}

// Helper functions for state restoration
function restoreAdvancedFormData(formData) {
    const form = document.getElementById('advancedSearchForm');
    if (!form || !formData) return;
    
    // Restore each form field
    for (let [key, value] of Object.entries(formData)) {
        const input = form.querySelector(`[name="${key}"]`);
        if (input) {
            if (input.type === 'checkbox' || input.type === 'radio') {
                input.checked = true;
            } else {
                input.value = value;
            }
        }
    }
    
    // Update chamber options if court type was selected
    const courtType = formData.court_type;
    if (courtType) {
        updateChamberOptions(courtType);
        // Restore chamber selection after options are updated
        setTimeout(() => {
            const chamberInput = form.querySelector('[name="chamber"]');
            if (chamberInput && formData.chamber) {
                chamberInput.value = formData.chamber;
            }
        }, 100);
    }
    
    // Show custom date range if needed
    if (formData.date_range === 'custom') {
        toggleCustomDateRange(true);
    }
}

function restoreAdvancedFormFromURL(urlParams) {
    const form = document.getElementById('advancedSearchForm');
    if (!form) return;
    
    // List of advanced search parameters
    const advancedParams = ['court_type', 'chamber', 'date_range', 'decision_number', 'case_number', 'sort_order', 'per_page'];
    
    advancedParams.forEach(param => {
        const value = urlParams.get(param);
        if (value) {
            const input = form.querySelector(`[name="${param}"]`);
            if (input) {
                input.value = value;
            }
        }
    });
    
    // Handle court type and chamber relationship
    const courtType = urlParams.get('court_type');
    if (courtType) {
        updateChamberOptions(courtType);
        setTimeout(() => {
            const chamber = urlParams.get('chamber');
            if (chamber) {
                const chamberInput = form.querySelector('[name="chamber"]');
                if (chamberInput) {
                    chamberInput.value = chamber;
                }
            }
        }, 100);
    }
    
    // Handle custom date range
    if (urlParams.get('date_range') === 'custom') {
        toggleCustomDateRange(true);
        const startDate = urlParams.get('custom_date_start');
        const endDate = urlParams.get('custom_date_end');
        if (startDate) {
            const startInput = form.querySelector('[name="custom_date_start"]');
            if (startInput) startInput.value = startDate;
        }
        if (endDate) {
            const endInput = form.querySelector('[name="custom_date_end"]');
            if (endInput) endInput.value = endDate;
        }
    }
}

// Global function for pagination
window.performSearch = performSearch;
window.applyQuickFilter = applyQuickFilter;
window.handlePaginationClick = handlePaginationClick;
window.saveCurrentState = saveCurrentState;
</script>
{% endblock %}