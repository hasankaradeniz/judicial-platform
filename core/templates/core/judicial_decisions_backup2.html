{% extends "core/base.html" %}
{% load static %}

{% block page_title %}Yargı Kararları - Lexatech{% endblock %}

{% block extra_styles %}
<style>
/* Modern, Clean CSS */
* {
    box-sizing: border-box;
}

body {
    background: #f8fafc;
    font-family: 'Inter', system-ui, sans-serif;
    line-height: 1.6;
    color: #1f2937;
}

/* Header */
.header {
    background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
    color: white;
    padding: 2rem 0;
    text-align: center;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0 0 0.5rem 0;
}

.header p {
    font-size: 1.1rem;
    opacity: 0.9;
    margin: 0;
}

/* Container */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
}

/* Search Section */
.search-section {
    background: white;
    margin: -1rem auto 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    padding: 2rem;
    position: relative;
    z-index: 10;
}

.search-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    text-align: center;
    color: #374151;
}

.search-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.search-input-full {
    grid-column: 1 / -1;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
    margin-bottom: 0.5rem;
}

.form-input {
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 1rem;
    transition: all 0.2s;
}

.form-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.search-input-wrapper {
    position: relative;
}

.search-input {
    padding-left: 2.5rem;
}

.search-icon {
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    color: #9ca3af;
}

.button-group {
    display: flex;
    gap: 1rem;
    justify-content: center;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: #3b82f6;
    color: white;
}

.btn-primary:hover {
    background: #2563eb;
    transform: translateY(-1px);
}

.btn-secondary {
    background: #f3f4f6;
    color: #374151;
}

.btn-secondary:hover {
    background: #e5e7eb;
}

/* Results */
.results-section {
    margin-bottom: 2rem;
}

.results-header {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.results-count {
    font-weight: 600;
    color: #1e40af;
}

.results-info {
    font-size: 0.875rem;
    color: #6b7280;
}

.results-grid {
    display: grid;
    gap: 1rem;
}

.result-card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    transition: all 0.2s;
    border-left: 4px solid #e5e7eb;
}

.result-card:hover {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    transform: translateY(-1px);
    border-left-color: #3b82f6;
}

.result-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 0.75rem;
}

.court-badge {
    background: #f3f4f6;
    color: #374151;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.court-badge.yargitay { background: #fef3c7; color: #92400e; }
.court-badge.danistay { background: #dbeafe; color: #1e40af; }
.court-badge.sayistay { background: #d1fae5; color: #065f46; }
.court-badge.anayasa { background: #fce7f3; color: #9f1239; }

.result-date {
    font-size: 0.875rem;
    color: #6b7280;
}

.result-title {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #111827;
}

.result-numbers {
    display: flex;
    gap: 1rem;
    font-size: 0.875rem;
    color: #6b7280;
    margin-bottom: 0.75rem;
}

.result-summary {
    color: #4b5563;
    margin-bottom: 1rem;
    line-height: 1.5;
}

.result-link {
    color: #3b82f6;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.875rem;
}

.result-link:hover {
    color: #2563eb;
    text-decoration: underline;
}

/* Pagination */
.pagination {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin: 2rem 0;
}

.page-link {
    padding: 0.5rem 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 4px;
    color: #374151;
    text-decoration: none;
    transition: all 0.2s;
}

.page-link:hover {
    background: #f3f4f6;
    border-color: #3b82f6;
    color: #3b82f6;
}

.page-link.active {
    background: #3b82f6;
    border-color: #3b82f6;
    color: white;
}

.page-link.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Loading */
.loading {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.loading-content {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    text-align: center;
}

.spinner {
    border: 3px solid #f3f4f6;
    border-top: 3px solid #3b82f6;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 3rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
}

.empty-icon {
    font-size: 3rem;
    color: #9ca3af;
    margin-bottom: 1rem;
}

.empty-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 0.5rem;
}

.empty-text {
    color: #6b7280;
}

/* Mobile */
@media (max-width: 768px) {
    .header h1 { font-size: 2rem; }
    .search-section { margin: -0.5rem 1rem 1rem; padding: 1.5rem; }
    .search-grid { grid-template-columns: 1fr; }
    .button-group { flex-direction: column; }
    .results-header { flex-direction: column; gap: 0.5rem; align-items: start; }
    .result-numbers { flex-direction: column; gap: 0.25rem; }
}
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="header">
    <div class="container">
        <h1>Yargı Kararları</h1>
        <p>Hukuki kararları arayın ve inceleyin</p>
    </div>
</div>

<!-- Search -->
<div class="container">
    <div class="search-section">
        <h2 class="search-title">Karar Arama</h2>
        <form method="get" action="{% url 'judicial_decisions' %}" id="searchForm">
            <div class="search-grid">
                <!-- Ana Arama -->
                <div class="form-group search-input-full">
                    <label class="form-label">Arama Terimi (Opsiyonel)</label>
                    <div class="search-input-wrapper">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" name="q" class="form-input search-input" 
                               placeholder="Karar metni, anahtar kelime..." value="{{ query }}">
                    </div>
                </div>
                
                <!-- Mahkeme Türü -->
                <div class="form-group">
                    <label class="form-label">Mahkeme Türü</label>
                    <select name="court_type" id="court_type" class="form-input">
                        <option value="">Tümü</option>
                        {% for stat in court_type_stats %}
                        <option value="{{ stat.karar_turu }}" {% if court_type == stat.karar_turu %}selected{% endif %}>
                            {{ stat.karar_turu }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Daire -->
                <div class="form-group">
                    <label class="form-label">Daire</label>
                    <select name="chamber" id="chamber" class="form-input">
                        <option value="">Tümü</option>
                    </select>
                </div>
                
                <!-- Karar Numarası -->
                <div class="form-group">
                    <label class="form-label">Karar Numarası</label>
                    <input type="text" name="decision_number" class="form-input" 
                           placeholder="Örn: 2021/1234" value="{{ decision_number }}">
                </div>
                
                <!-- Esas Numarası -->
                <div class="form-group">
                    <label class="form-label">Esas Numarası</label>
                    <input type="text" name="case_number" class="form-input" 
                           placeholder="Örn: 2021/5678" value="{{ case_number }}">
                </div>
                
                <!-- Tarih -->
                <div class="form-group">
                    <label class="form-label">Tarih Aralığı</label>
                    <select name="date_range" class="form-input">
                        <option value="">Tüm Zamanlar</option>
                        <option value="today" {% if date_range == 'today' %}selected{% endif %}>Bugün</option>
                        <option value="week" {% if date_range == 'week' %}selected{% endif %}>Son 1 Hafta</option>
                        <option value="month" {% if date_range == 'month' %}selected{% endif %}>Son 1 Ay</option>
                        <option value="3months" {% if date_range == '3months' %}selected{% endif %}>Son 3 Ay</option>
                        <option value="6months" {% if date_range == '6months' %}selected{% endif %}>Son 6 Ay</option>
                        <option value="year" {% if date_range == 'year' %}selected{% endif %}>Son 1 Yıl</option>
                    </select>
                </div>
            </div>
            
            <div class="button-group">
                <button type="button" class="btn btn-secondary" onclick="clearForm()">
                    <i class="fas fa-times"></i> Temizle
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> Ara
                </button>
            </div>
        </form>
    </div>

    <!-- Results -->
    <div class="results-section">
        {% if decisions.object_list %}
            <div class="results-header">
                <span class="results-count">{{ total_count|floatformat:0 }} sonuç bulundu</span>
                {% if search_time %}
                <span class="results-info">({{ search_time }} ms)</span>
                {% endif %}
            </div>
            
            <div class="results-grid">
                {% for decision in decisions %}
                <div class="result-card">
                    <div class="result-header">
                        <span class="court-badge {{ decision.karar_turu|lower }}">
                            {{ decision.karar_turu }}
                        </span>
                        {% if decision.karar_tarihi %}
                        <span class="result-date">{{ decision.karar_tarihi|date:"d.m.Y" }}</span>
                        {% endif %}
                    </div>
                    
                    <h3 class="result-title">{{ decision.karar_veren_mahkeme }}</h3>
                    
                    <div class="result-numbers">
                        {% if decision.esas_numarasi %}
                        <span><strong>Esas:</strong> {{ decision.esas_numarasi }}</span>
                        {% endif %}
                        {% if decision.karar_numarasi %}
                        <span><strong>Karar:</strong> {{ decision.karar_numarasi }}</span>
                        {% endif %}
                    </div>
                    
                    {% if decision.karar_ozeti %}
                    <p class="result-summary">{{ decision.karar_ozeti|truncatewords:30 }}</p>
                    {% endif %}
                    
                    <a href="{% url 'judicial_detail' decision.id %}" class="result-link">
                        Detayları Görüntüle <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                {% endfor %}
            </div>
            
            {% if decisions.has_other_pages %}
            <div class="pagination">
                {% if decisions.has_previous %}
                <a href="?q={{ query }}&court_type={{ court_type }}&chamber={{ chamber }}&date_range={{ date_range }}&decision_number={{ decision_number }}&case_number={{ case_number }}&page={{ decisions.previous_page_number }}" class="page-link">
                    <i class="fas fa-chevron-left"></i>
                </a>
                {% endif %}
                
                {% for num in page_range %}
                    {% if num == decisions.number %}
                        <span class="page-link active">{{ num }}</span>
                    {% elif num == '...' %}
                        <span class="page-link disabled">...</span>
                    {% else %}
                        <a href="?q={{ query }}&court_type={{ court_type }}&chamber={{ chamber }}&date_range={{ date_range }}&decision_number={{ decision_number }}&case_number={{ case_number }}&page={{ num }}" class="page-link">{{ num }}</a>
                    {% endif %}
                {% endfor %}
                
                {% if decisions.has_next %}
                <a href="?q={{ query }}&court_type={{ court_type }}&chamber={{ chamber }}&date_range={{ date_range }}&decision_number={{ decision_number }}&case_number={{ case_number }}&page={{ decisions.next_page_number }}" class="page-link">
                    <i class="fas fa-chevron-right"></i>
                </a>
                {% endif %}
            </div>
            {% endif %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-search empty-icon"></i>
                <h3 class="empty-title">
                    {% if query or court_type or chamber or date_range or decision_number or case_number %}
                        Sonuç bulunamadı
                    {% else %}
                        Arama yapın
                    {% endif %}
                </h3>
                <p class="empty-text">
                    {% if query or court_type or chamber or date_range or decision_number or case_number %}
                        Farklı kriterlerle tekrar deneyin
                    {% else %}
                        Yukarıdaki formu kullanarak yargı kararlarını arayabilirsiniz
                    {% endif %}
                </p>
            </div>
        {% endif %}
    </div>
</div>

<!-- Loading -->
<div class="loading" id="loading">
    <div class="loading-content">
        <div class="spinner"></div>
        <p>Arama yapılıyor...</p>
    </div>
</div>

<script>
// Chamber data
const chambers = {
    'YARGITAY': [
        '1. Hukuk Dairesi', '2. Hukuk Dairesi', '3. Hukuk Dairesi', '4. Hukuk Dairesi',
        '5. Hukuk Dairesi', '6. Hukuk Dairesi', '7. Hukuk Dairesi', '8. Hukuk Dairesi',
        '9. Hukuk Dairesi', '10. Hukuk Dairesi', '11. Hukuk Dairesi', '12. Hukuk Dairesi',
        '13. Hukuk Dairesi', '14. Hukuk Dairesi', '15. Hukuk Dairesi', '16. Hukuk Dairesi',
        '17. Hukuk Dairesi', '18. Hukuk Dairesi', '19. Hukuk Dairesi', '20. Hukuk Dairesi',
        '21. Hukuk Dairesi', '22. Hukuk Dairesi', '23. Hukuk Dairesi',
        '1. Ceza Dairesi', '2. Ceza Dairesi', '3. Ceza Dairesi', '4. Ceza Dairesi',
        '5. Ceza Dairesi', '6. Ceza Dairesi', '7. Ceza Dairesi', '8. Ceza Dairesi',
        '9. Ceza Dairesi', '10. Ceza Dairesi', '11. Ceza Dairesi', '12. Ceza Dairesi',
        '13. Ceza Dairesi', '14. Ceza Dairesi', '15. Ceza Dairesi', '16. Ceza Dairesi'
    ],
    'DANISTAY': [
        '1. Daire', '2. Daire', '3. Daire', '4. Daire', '5. Daire',
        '6. Daire', '7. Daire', '8. Daire', '9. Daire', '10. Daire',
        '11. Daire', '12. Daire', '13. Daire', '14. Daire', '15. Daire',
        'İdari Dava Daireleri Kurulu', 'Vergi Dava Daireleri Kurulu'
    ],
    'SAYISTAY': [
        '1. Daire', '2. Daire', '3. Daire', '4. Daire', '5. Daire',
        '6. Daire', '7. Daire', 'Genel Kurul'
    ],
    'ANAYASA MAHKEMESI': [
        'Birinci Bölüm', 'İkinci Bölüm', 'Genel Kurul'
    ]
};

// Update chambers when court type changes
document.getElementById('court_type').addEventListener('change', function() {
    const courtType = this.value;
    const chamberSelect = document.getElementById('chamber');
    const selectedChamber = '{{ chamber|escapejs }}';
    
    chamberSelect.innerHTML = '<option value="">Tümü</option>';
    
    if (courtType && chambers[courtType]) {
        chambers[courtType].forEach(function(chamber) {
            const option = document.createElement('option');
            option.value = chamber;
            option.textContent = chamber;
            if (selectedChamber === chamber) {
                option.selected = true;
            }
            chamberSelect.appendChild(option);
        });
    }
});

// Initialize chambers on load
document.addEventListener('DOMContentLoaded', function() {
    const courtTypeSelect = document.getElementById('court_type');
    if (courtTypeSelect.value) {
        courtTypeSelect.dispatchEvent(new Event('change'));
    }
});

// Show loading on form submit
document.getElementById('searchForm').addEventListener('submit', function() {
    document.getElementById('loading').style.display = 'flex';
});

// Clear form
function clearForm() {
    document.getElementById('searchForm').reset();
    document.getElementById('chamber').innerHTML = '<option value="">Tümü</option>';
    window.location.href = '{% url "judicial_decisions" %}';
}
</script>
{% endblock %}