{% extends "core/base.html" %}
{% load static %}

{% block page_title %}GeliÅŸmiÅŸ Mevzuat Sistemi - Lexatech{% endblock %}

{% block extra_styles %}
<style>
  .hero-section {
    position: relative;
    color: #fff;
    overflow: hidden;
  }

  .hero-section::before {
    content: "";
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.4);
    z-index: 1;
  }

  .hero-section .container {
    position: relative;
    z-index: 2;
  }

  .hero-section h1,
  .hero-section p.lead {
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
  }
  
  .stats-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    transition: transform 0.3s ease;
  }
  
  .stats-card:hover {
    transform: translateY(-5px);
  }
  
  .border-left-primary {
    border-left: 4px solid #4e73df !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
  <!-- Hero Section -->
  <div class="hero-section"
       style="background: url('{% static 'core/images/mevzuat_bg.jpg' %}') no-repeat center center;
              background-size: cover;
              padding: 60px 0;">
    <div class="container text-center">
      <h1 class="mb-4" style="font-weight: 700;">GELÄ°ÅMÄ°Å MEVZUAT SÄ°STEMÄ°</h1>
      <p class="lead mb-2" style="font-weight: 400;">{{ total_mevzuat|default:0 }} Mevzuat â€¢ {{ total_madde|default:0 }} Madde</p>
      <p class="lead mb-4" style="font-weight: 400;">KapsamlÄ± mevzuat aramasÄ± iÃ§in kelime veya cÃ¼mle giriniz.</p>
      
      <div class="row justify-content-center">
        <div class="col-md-10">
          <form method="get" action="{% url 'legislation_results' %}">
            <div class="input-group input-group-lg">
              <input type="text" class="form-control" name="q" 
                     placeholder="Mevzuat baÅŸlÄ±ÄŸÄ±, konusu, anahtar kelime veya numara..." required>
              <select name="mevzuat_turu" class="form-select" style="max-width: 200px;">
                <option value="">TÃ¼m TÃ¼rler</option>
                {% for turu in mevzuat_turu_stats %}
                  <option value="{{ turu.mevzuat_turu__id }}">{{ turu.mevzuat_turu__ad }} ({{ turu.count }})</option>
                {% endfor %}
              </select>
              <button class="btn btn-primary" type="submit" style="min-width: 100px;">
                ğŸ” Ara
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Ä°statistik KartlarÄ± -->
  <div class="row mt-5 mb-4">
    <div class="col-md-3 mb-3">
      <div class="card stats-card shadow text-center">
        <div class="card-body">
          <div class="display-4 mb-2">ğŸ“œ</div>
          <h4 class="card-title">{{ total_mevzuat|default:0 }}</h4>
          <p class="card-text">Toplam Mevzuat</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card stats-card shadow text-center">
        <div class="card-body">
          <div class="display-4 mb-2">ğŸ“„</div>
          <h4 class="card-title">{{ total_madde|default:0 }}</h4>
          <p class="card-text">Toplam Madde</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card stats-card shadow text-center">
        <div class="card-body">
          <div class="display-4 mb-2">ğŸ“š</div>
          <h4 class="card-title">{{ mevzuat_turu_stats|length }}</h4>
          <p class="card-text">Mevzuat TÃ¼rÃ¼</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card stats-card shadow text-center">
        <div class="card-body">
          <div class="display-4 mb-2">âš–ï¸</div>
          <h4 class="card-title">2024</h4>
          <p class="card-text">GÃ¼ncel Sistem</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Mevzuat TÃ¼rleri -->
  <div class="row mt-5">
    <div class="col-12">
      <h3 class="text-center mb-4">ğŸ“Š Mevzuat TÃ¼rlerine GÃ¶re DaÄŸÄ±lÄ±m</h3>
      <div class="row">
        {% for turu in mevzuat_turu_stats %}
        <div class="col-md-3 mb-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center">
              <div class="display-4 mb-3">
                {% if turu.mevzuat_turu__kategori == 'kanun' %}ğŸ“œ
                {% elif turu.mevzuat_turu__kategori == 'cumhurbaskanligi_kararnamesi' %}ğŸ“‹
                {% elif turu.mevzuat_turu__kategori == 'yonetmelik' %}ğŸ“‘
                {% elif turu.mevzuat_turu__kategori == 'tuzuk' %}ğŸ“„
                {% elif turu.mevzuat_turu__kategori == 'genelge' %}ğŸ“
                {% else %}ğŸ“°{% endif %}
              </div>
              <h6 class="card-title">{{ turu.mevzuat_turu__ad }}</h6>
              <h4 class="text-primary mb-3">{{ turu.count }}</h4>
              <a href="{% url 'legislation_results' %}?mevzuat_turu={{ turu.mevzuat_turu__id }}" 
                 class="btn btn-outline-primary btn-sm">
                GÃ¶rÃ¼ntÃ¼le
              </a>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12">
          <div class="text-center text-muted">
            <p>HenÃ¼z mevzuat tÃ¼rÃ¼ bulunmuyor.</p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Son Eklenen Mevzuatlar -->
  <div class="row mt-5">
    <div class="col-12">
      <h4 class="mb-4">ğŸ“… Son Eklenen Mevzuatlar</h4>
      <div class="row">
        {% for mevzuat in son_mevzuatlar %}
        <div class="col-md-6 mb-3">
          <div class="card border-left-primary shadow-sm">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                    {{ mevzuat.mevzuat_turu.ad }}
                  </div>
                  <div class="h6 mb-0 font-weight-bold text-gray-800">
                    <a href="{% url 'legislation_detail' mevzuat.pk %}" class="text-decoration-none">
                      {{ mevzuat.baslik|truncatechars:60 }}
                    </a>
                  </div>
                  <div class="text-xs text-muted mt-1">
                    {% if mevzuat.mevzuat_numarasi %}No: {{ mevzuat.mevzuat_numarasi }} â€¢ {% endif %}
                    {{ mevzuat.yayin_tarihi|date:"d.m.Y"|default:"Tarih belirtilmemiÅŸ" }}
                  </div>
                </div>
                <div class="col-auto">
                  <div class="text-muted">
                    <small>{{ mevzuat.kayit_tarihi|timesince }} Ã¶nce</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12">
          <div class="text-center text-muted">
            <p>HenÃ¼z mevzuat bulunmuyor.</p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Kategori Chart -->
  {% if kategori_chart_data %}
  <div class="row mt-5">
    <div class="col-12">
      <h4 class="text-center mb-4">ğŸ“ˆ Kategoriye GÃ¶re DaÄŸÄ±lÄ±m</h4>
      <div class="text-center">
        <canvas id="kategoriChart" width="400" height="200"></canvas>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- GeliÅŸmiÅŸ Arama Butonu -->
  <div class="text-center mt-5 mb-5">
    <a href="{% url 'legislation_results' %}" class="btn btn-outline-secondary btn-lg">
      ğŸ”§ GeliÅŸmiÅŸ Arama
    </a>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  {% if kategori_chart_data %}
  const ctx = document.getElementById('kategoriChart').getContext('2d');
  const chartData = {{ kategori_chart_data|safe }};
  
  const kategoriChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: chartData.labels,
      datasets: [{
        data: chartData.data,
        backgroundColor: [
          '#FF6384',
          '#36A2EB', 
          '#FFCE56',
          '#4BC0C0',
          '#9966FF',
          '#FF9F40',
          '#FF6384',
          '#36A2EB'
        ],
        borderWidth: 2,
        borderColor: '#fff'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom',
        },
        title: {
          display: true,
          text: 'Mevzuat Kategorileri DaÄŸÄ±lÄ±mÄ±'
        }
      }
    }
  });
  {% endif %}
});
</script>
{% endblock %}